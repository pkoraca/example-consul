---

-   name: Install python setup tools
    yum:
      name: python-setuptools

- name: Install python devel
  yum:
    name: python-devel

- name: Install mysql devel
  yum:
    name: mysql-devel

-   name: Install Pypi
    easy_install:
      name: pip

-   name: Install docker-py
    pip:
      name: docker-py
      version: 1.9.0

- name: Install MySQL-python
  pip:
    name: MySQL-python

- name: Install Flask
  pip:
    name: Flask

- name: Install python-consul
  pip:
    name: python-consul

-   name: Install Docker
    yum:
      name: docker
      state: latest

-   name: Make sure Docker is running
    service:
      name: docker
      state: running

- name: Pull Consul image
  docker_image:
    name: consul

- name: Pull MySQL image
  docker_image:
    name: mysql

- name: Create a Consul container
  docker_container:
    name: myconsul
    image: consul
    network_mode: host

- name: Create a MySQL container
  docker_container:
    name: mydb
    image: docker.io/mysql
    ports:
      - "127.0.0.1:3306:3306"
    env:
       MYSQL_ROOT_PASSWORD: my-secret-pw

- name: Create a Registrator container
  docker_container:
    name: registrator
    image: gliderlabs/registrator
    network_mode: host
    command: consul://localhost:8500
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock
